import{h as H,j as b,k as y,l as D,s as f,v as n,w as A}from"./chunk-PWXOGFPV.js";import{D as k,J as I,U as d,X as w,ba as o,g as v,l as u,o as T,r as O}from"./chunk-4S75Y5RT.js";var B=(t,e)=>e(t).pipe(k(r=>{let s=r.status===500?"\uC11C\uBC84 \uC624\uB958\uAC00 \uC0DD\uACBC\uC2B5\uB2C8\uB2E4. \u{1F4A9}":`${r.error.message}`;return r.status===500?(alert(s),u):T(()=>r)}));var P=(t,e)=>{let r=o(A);return r.setLoading(!0),e(t).pipe(I(()=>r.setLoading(!1)))};var m=class t{http=o(D);login(e){return this.http.post(`${n.serverUrl}/v1/auth/login`,e,{context:i()})}register(e){return this.http.post(`${n.serverUrl}/v1/auth/register`,e,{context:i()})}generateOtp(e){return this.http.post(`${n.serverUrl}/v1/auth/otp/generate`,e,{context:i()})}verifyOtp(e){return this.http.post(`${n.serverUrl}/v1/auth/otp/verify`,e,{context:i()})}refresh(e){let r=new H;return r=r.append("x-refresh-token",e),this.http.post(`${n.serverUrl}/v1/auth/refresh`,{},{context:i(),headers:r})}logout(){return this.http.delete(`${n.serverUrl}/v1/auth/logout`)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=w({token:t,factory:t.\u0275fac,providedIn:"root"})};var c=class t{accessToken=null;expiresIn=null;refreshTokenKey="RT";static instance;constructor(){}static getInstance(){return this.instance||(this.instance=new t),this.instance}getAccessToken(){return this.accessToken}getRefreshToken(){return localStorage.getItem(this.refreshTokenKey)}getExpiresIn(){return this.expiresIn}store(e){let{accessToken:r,expiresIn:s,refreshToken:p}=e;this.accessToken=r,this.expiresIn=s,p&&localStorage.setItem(this.refreshTokenKey,p)}clear(){this.accessToken=null,this.expiresIn=null,localStorage.removeItem(this.refreshTokenKey)}};var he=()=>{let t=o(f),r=!!c.getInstance().getRefreshToken();return r||(alert("\uB85C\uADF8\uC778 \uBA3C\uC800 \uC9C4\uD589\uD574\uC8FC\uC138\uC694!"),t.navigateByUrl("/login")),r};var l=c.getInstance(),S=new b(()=>!1),g=[],x=!1;function i(){return new y().set(S,!0)}var Ue=(t,e)=>{let r=o(m),s=o(f);if(t.context.get(S)||t.url.includes("assets/icons")&&t.url.endsWith(".svg"))return e(t);let p=l.getRefreshToken();if(!p)return alert("\uC138\uC158\uC774 \uB9CC\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uB85C\uADF8\uC778\uD574\uC8FC\uC138\uC694."),s.navigateByUrl("/login"),u;if(U())return console.log("\uB9CC\uB8CC\uB428"),x||(x=!0,O(r.refresh(p)).then(a=>{console.log("\uD1A0\uD070 \uC7AC\uBC1C\uAE09\uC911 .."),l.store(a),g.forEach(h=>h())}).catch(a=>{console.log(a),alert("\uC138\uC158\uC774 \uB9CC\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uB85C\uADF8\uC778\uD574\uC8FC\uC138\uC694."),s.navigateByUrl("/login")}).finally(()=>{x=!1,console.log(g)})),new v(a=>{g.push(()=>{let h=l.getAccessToken(),F=t.clone({setHeaders:{Authorization:`Bearer ${h}`}});e(F).subscribe(a)})}).pipe(d(console.log));let R=l.getAccessToken(),j=t.clone({setHeaders:{Authorization:`Bearer ${R}`}});return e(j)},U=()=>{let t=l.getExpiresIn();return t?t*1e3-Date.now()<5*60*1e3:!0};export{i as a,Ue as b,B as c,P as d,m as e,c as f,he as g};
