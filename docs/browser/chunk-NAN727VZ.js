import{a as W}from"./chunk-I7S2FCIU.js";import"./chunk-4GZSFRTA.js";import{a as V,b as N,d as G,e as M,h as R,i as j,j as U,k as z,m as $,n as q}from"./chunk-NLQUPEL3.js";import{a as O}from"./chunk-DGXU2TAC.js";import{a as J}from"./chunk-5ZBA7CN6.js";import{b as H,c as L}from"./chunk-GAMVPAQP.js";import{A as P,Ba as A,D as m,Fa as E,G as d,Ga as S,H as f,Qa as I,T as D,U as c,Ua as k,_ as B,aa as w,db as T,ea as h,ia as u,la as b,ma as v,na as y,oa as F,pa as a,qa as r,ra as s,sa as x,ta as g,ua as p,za as l}from"./chunk-LFJQS5LE.js";var _=class i{http=m(k);createPost(t){let e=this.convertToFormData(t);return this.http.post(`${T.serverUrl}/v1`,e,{headers:{}})}convertToFormData(t){let e=new FormData;return console.log(e),Object.keys(t).forEach(o=>{let n=t[o];console.log(o,n),n instanceof File?e.append(o,n):Array.isArray(n)?e.append(o,JSON.stringify(n)):e.append(o,n)}),console.log("\u{1F4CC} FormData \uCD9C\uB825:"),e.forEach((o,n)=>{console.log(`${n}:`,o)}),e}static \u0275fac=function(e){return new(e||i)};static \u0275prov=P({token:i,factory:i.\u0275fac,providedIn:"root"})};function Y(i,t){if(i&1&&s(0,"img",8),i&2){let e=p(2);u("src",e.previewUrl,D)}}function Z(i,t){i&1&&(a(0,"div",9)(1,"p"),l(2,"\uC0AC\uC9C4\uC744 \uC120\uD0DD\uD574\uC8FC\uC138\uC694."),r()())}function ee(i,t){if(i&1&&(a(0,"div",15)(1,"div"),s(2,"input",17),a(3,"span",18),l(4,"\uB178\uCD9C"),r()(),s(5,"input",19),r()),i&2){let e=t.$implicit;u("formGroup",e)}}function te(i,t){if(i&1){let e=x();a(0,"form",5)(1,"input",7),g("change",function(n){d(e);let C=p();return f(C.upload(n))}),r(),h(2,Y,1,1,"img",8)(3,Z,3,0,"div",9),a(4,"label",10)(5,"span"),l(6,"\uAC8C\uC2DC\uBB3C \uC81C\uBAA9"),r(),s(7,"input",11),r(),a(8,"label",10)(9,"span"),l(10,"\uAC8C\uC2DC\uBB3C \uB0B4\uC6A9"),r(),s(11,"textarea",12),r(),a(12,"div",13)(13,"span",14),l(14,"\uC0AC\uC9C4\uB0B4\uC6A9"),r(),y(15,ee,6,1,"div",15,v),r(),a(17,"app-button",16),g("click",function(){d(e);let n=p();return f(n.updateState())}),r()()}if(i&2){let e=p();u("formGroup",e.postCreateForm),c(2),b(e.previewUrl?2:3),c(13),F(e.metadataArray.controls)}}function oe(i,t){if(i&1){let e=x();a(0,"div",21)(1,"input",27),g("change",function(n){let C=d(e).$implicit,Q=p(2);return f(Q.selectCollection(C.collectionId,n))}),r(),s(2,"app-collection-card",28),r()}if(i&2){let e=t.$implicit,o=p(2);c(),u("checked",o.postCreateForm.value.collectionId===e.collectionId),c(),u("title",e.title)("collectionId",e.collectionId)("category",e.category)("images",e.imageUrls)}}function ie(i,t){if(i&1){let e=x();a(0,"div",20),y(1,oe,3,5,"div",21,v),r(),a(3,"div",22)(4,"span",23),l(5,"\uBBF8\uBD84\uB958"),r(),a(6,"div"),s(7,"input",24)(8,"div",25),r()(),a(9,"app-button",26),g("click",function(){d(e);let n=p();return f(n.createCollection())}),r()}if(i&2){let e=p();c(),F(e.collections)}}var K=class i{step=B(1);previewUrl=null;postCreateForm;collections=[];fb=m($);postApi=m(_);collectionApi=m(O);modalReactiveService=m(L);get metadataArray(){return this.postCreateForm.get("metadataStringify")}constructor(){this.postCreateForm=this.fb.group({collectionId:"",title:"",content:"",metadataStringify:this.fb.array([]),file:""}),this.initializeMetadata(),this.collectionApi.getCollections().subscribe(t=>{this.collections=t.items})}ngOnInit(){}upload(t){let e=t.target;if(e.files&&e.files[0]){let o=e.files[0];this.postCreateForm.patchValue({file:o}),console.log(this.postCreateForm.value);let n=new FileReader;n.onload=C=>{this.previewUrl=C.target?.result},n.readAsDataURL(o)}}initializeMetadata(){Array.from({length:4},(e,o)=>({content:`(\uC784\uC2DC) \uC0AC\uC9C4\uB0B4\uC6A9 ${o+1}`,isPublic:!1})).forEach(e=>this.addMetadata(e.content,e.isPublic))}addMetadata(t="",e=!1){let o=this.fb.group({content:[t],isPublic:[e]});this.metadataArray.push(o)}updateState(){this.step.set(2)}selectCollection(t,e){e.target.checked?this.postCreateForm.patchValue({collectionId:t}):this.postCreateForm.patchValue({collectionId:""})}createCollection(){let t=this.postCreateForm.getRawValue();console.log(t),this.postApi.createPost(t).subscribe(e=>{console.log(e)})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["post-create-page"]],decls:15,vars:5,consts:[[1,"flex","flex-col","min-h-screen","bg-secondary5","border-x"],[1,"sticky","top-0","z-10","flex","items-center","justify-between","w-full","px-4","py-5","bg-white","border-b","shadow-sm"],[1,"mr-3","text-xl","font-bold"],[1,"text-xl","font-bold"],[1,"flex-1","w-full","px-4","py-6"],[1,"flex","flex-col","gap-5",3,"formGroup"],[1,"sticky","bottom-0","mt-auto"],["type","file",3,"change"],["alt","\uC784\uC2DC \uC774\uBBF8\uC9C0",1,"h-[485px]","rounded-lg",3,"src"],[1,"bg-gray20","flex","h-[485px]","items-center","justify-center","rounded-lg","border"],[1,"flex","flex-col","gap-2"],["type","text","placeholder","\uAC8C\uC2DC\uBB3C \uC81C\uBAA9\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694.","formControlName","title"],["placeholder","\uAC8C\uC2DC\uBB3C \uB0B4\uC6A9\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694.","formControlName","content","rows","10",1,"p-4","border","border-black","rounded-lg","resize-none"],["formArrayName","metadataStringify"],[1,"block","mb-3"],[1,"flex","gap-3","mb-3","last-of-type:mb-0",3,"formGroup"],["text","\uB2E4\uC74C \uB2E8\uACC4\uB85C","width","full",3,"click"],["formControlName","isPublic","type","checkbox",1,"w-6","h-6"],[1,"block","text-sm"],["formControlName","content","type","text",1,"flex-1"],[1,"grid","grid-cols-2","gap-5","pb-5","border-b","border-b-gray-600"],[1,""],[1,"pt-5"],[1,"font-bold"],["type","checkbox",1,"absolute","z-20","w-6","h-6"],[1,"relative","h-[140px]","rounded-[12px]","bg-white","shadow-md","hover:cursor-pointer","hover:shadow-xl"],["text","\uC120\uD0DD\uD55C \uC0AC\uC9C4\uCCA9\uC5D0 \uC800\uC7A5","width","full",1,"mt-5",3,"click"],["type","checkbox",1,"absolute","z-20","w-6","h-6",3,"change","checked"],[3,"title","collectionId","category","images"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"header",1)(2,"div")(3,"button",2),l(4,"<"),r(),a(5,"span",3),l(6,"\uAC8C\uC2DC\uBB3C \uC0DD\uC131"),r()(),a(7,"span"),l(8),r()(),a(9,"div",4),h(10,te,18,2,"form",5)(11,ie,10,0),r(),l(12),E(13,"json"),s(14,"app-footer",6),r()),e&2&&(c(8),A("",o.step(),"/2"),c(2),b(o.step()===1?10:11),c(2),A(" ",S(13,3,o.postCreateForm.value)," "))},dependencies:[H,J,q,R,N,V,G,M,j,z,U,I,W],encapsulation:2})};export{K as PostCreatePage};
